---
title: "Untitled"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## R Markdown

This is an R Markdown document. Markdown is a simple formatting syntax for authoring HTML, PDF, and MS Word documents. For more details on using R Markdown see <http://rmarkdown.rstudio.com>.

When you click the **Knit** button a document will be generated that includes both content as well as the output of any embedded R code chunks within the document. You can embed an R code chunk like this:

```{r pupillometry}

files <- list.files(pattern="gaze_timeseries_all")

for (file in files){
    
    # if the merged dataset doesn't exist, create it
    if (!exists("dataset")){
        dataset <- read.table(file, header=TRUE, sep=" ")
    }
    
    
    # if the merged dataset does exist, append to it
    if (exists("dataset")){
        temp_dataset <-read.table(file, header=TRUE, sep=" ")
        dataset<-rbind.fill(dataset, temp_dataset)
        rm(temp_dataset)
    }
    
}

files <- files[1:length(files)]

dataset=dataset[dataset$subject>110000 & dataset$subject < 1100000,]

group_gaze_all <- dataset[,2:4]
group_gaze_all_m <- aggregate(group_gaze_all, by=list(group_gaze_all$time, group_gaze_all$axis), FUN=mean, na.rm=TRUE)
group_gaze_all_sd <- aggregate(group_gaze_all, by=list(group_gaze_all$time, group_gaze_all$axis), FUN=sd, na.rm=TRUE)
group_gaze_all_se <- group_gaze_all_sd$distance / sqrt(length(unique(dataset$subject)))

group_gaze_all_m <- data.frame(group_gaze_all_m[,c(2:4)], group_gaze_all_se)
colnames(group_gaze_all_m) <- c("axis", "time", "distance", "se")

ggplot(data=group_gaze_all_m, aes(x=time, y=distance, group=axis)) +  
  geom_line(aes(color=axis)) +  geom_linerange(aes(ymin=group_gaze_all_m$distance - group_gaze_all_m$se, ymax=group_gaze_all_m$distance + group_gaze_all_m$se, color=group_gaze_all_m$axis, alpha=.05, show.legend=NA)) +
  ggtitle("Gaze timeline") +
  xlab("time (ms)") +
  ylab("Distance (pixels)")


rm(list=setdiff(ls(), c("group_pupil_all", "group_pupil_all_m")))
```

## Including Plots

You can also embed plots, for example:



```{r pressure, echo=FALSE}

files <- list.files(pattern="gaze_timeseries_con")

for (file in files){
    
    # if the merged dataset doesn't exist, create it
    if (!exists("dataset")){
        dataset <- read.table(file, header=TRUE, sep=" ")
    }
    
    
    # if the merged dataset does exist, append to it
    if (exists("dataset")){
        temp_dataset <-read.table(file, header=TRUE, sep=" ")
        dataset<-rbind.fill(dataset, temp_dataset)
        rm(temp_dataset)
    }
    
}


files <- files[1:length(files)]

dataset=dataset[dataset$subject>110000 & dataset$subject < 1100000,]

colnames(dataset) <- c("subject", "time", "distance_x", "condition", "distance_y")
group_gaze_target_x <- dataset[,c(2,4,3)]
group_gaze_target_y <- dataset[,c(4,2,5)]

group_gaze_target_m_x <- aggregate(group_gaze_target_x, by=list(group_gaze_target_x$condition, group_gaze_target_x$time), FUN=mean, na.rm=TRUE)
group_gaze_target_sd_x <- aggregate(group_gaze_target_x, by=list(group_gaze_target_x$condition, group_gaze_target_x$time), FUN=sd, na.rm=TRUE)
group_gaze_target_se_x <- group_gaze_target_sd_x$distance / sqrt(length(unique(dataset$subject)))


group_gaze_target_m_y <- aggregate(group_gaze_target_y, by=list(group_gaze_target_y$condition, group_gaze_target_y$time), FUN=mean, na.rm=TRUE)
group_gaze_target_sd_y <- aggregate(group_gaze_target_y, by=list(group_gaze_target_y$condition, group_gaze_target_y$time), FUN=sd, na.rm=TRUE)
group_gaze_target_se_y <- group_gaze_target_sd_y$distance / sqrt(length(unique(dataset$subject)))

group_gaze_target_m_x <- data.frame(group_gaze_target_m_x[,c(1,3,5)], group_gaze_target_se_x)
colnames(group_gaze_target_m_x) <- c("target_condition", "time", "distance", "se")

group_gaze_target_m_y <- data.frame(group_gaze_target_m_y[,c(1,4,5)], group_gaze_target_se_y)
colnames(group_gaze_target_m_y) <- c("target_condition", "time", "distance", "se")

ggplot(data=group_gaze_target_m_x, aes(x=time, y=distance, group=target_condition)) +  
  geom_line(aes(color=target_condition)) + geom_linerange(aes(ymin=group_gaze_target_m_x$distance - group_gaze_target_m_x$se, ymax=group_gaze_target_m_x$distance + group_gaze_target_m_x$se, color=target_condition, alpha=.05, show.legend=NA)) +
  ggtitle("x-axis") +
  xlab("time (ms)") +
  ylab("Distance (pix)")

ggplot(data=group_gaze_target_m_y, aes(x=time, y=distance, group=target_condition)) +  
  geom_line(aes(color=target_condition)) + geom_linerange(aes(ymin=group_gaze_target_m_y$distance - group_gaze_target_m_y$se, ymax=group_gaze_target_m_y$distance + group_gaze_target_m_y$se, color=target_condition, alpha=.05, show.legend=NA)) +
  ggtitle("y-axis") +
  xlab("time (ms)") +
  ylab("Distance (pix)")



rm(list=setdiff(ls(), c("group_gaze_target_x", "group_gaze_target_m_x", "group_gaze_target_y", "group_gaze_target_m_y")))

```

Note that the `echo = FALSE` parameter was added to the code chunk to prevent printing of the R code that generated the plot.
