---
title: "Preprocess"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)

ipak <- function(pkg){
    new.pkg <- pkg[!(pkg %in% installed.packages()[, "Package"])]
    if (length(new.pkg)) 
        install.packages(new.pkg, dependencies = TRUE)
    sapply(pkg, require, character.only = TRUE)
}

# usage
packages <- c("factoextra", "dplyr", "psych", "kableExtra", "reshape2", "ggplot2", "compareGroups", "ggpubr", "mice", "rmarkdown")
ipak(packages)



```

## R Markdown

This is an R Markdown document. Markdown is a simple formatting syntax for authoring HTML, PDF, and MS Word documents. For more details on using R Markdown see <http://rmarkdown.rstudio.com>.

When you click the **Knit** button a document will be generated that includes both content as well as the output of any embedded R code chunks within the document. You can embed an R code chunk like this:

```{r preprocess, echo=FALSE, warning=FALSE}

vis_mem_cap <- et_raw$encoding_1.x
vis_mem_rate <- et_raw$encoding_1.x - et_raw$encoding_5.x
vis_mem_enc <- et_raw$encoding_sum.x
vis_mem_cons <- (10 - et_raw$recognition_fn.x) - et_raw$encoding_5.x
vis_mem_ret <- et_raw$encoding_5.x - et_raw$retrieval.x

ver_mem_cap <- et_raw$encoding_1.y
ver_mem_rate <- et_raw$encoding_5.y - et_raw$encoding_1.y
ver_mem_enc <- et_raw$encoding_sum.y
ver_mem_cons <- et_raw$encoding_5.y - (15 - et_raw$recognition_fn.y)
ver_mem_ret <- et_raw$retrieval.y - et_raw$encoding_5.y

visuom_fixed_m <- et_raw$overall_fixed_m
visuom_fixed_sd <-  et_raw$overall_fixed_sd
visuom_random_d <- et_raw$overall_random_m - et_raw$overall_fixed_m
visuom_speed_d <- (et_raw$mean_dev_fixed_8 + et_raw$mean_dev_random_8) - (et_raw$mean_dev_fixed_2 + et_raw$mean_dev_random_2)

et_raw$visualWM_vooruit_corr.x <- as.numeric(et_raw$vooruit_corr.x)
et_raw$visualWM_vooruit_span.x <- as.numeric(et_raw$vooruit_span.x)
vis_wm_enc <- et_raw$visualWM_vooruit_corr.x * et_raw$visualWM_vooruit_span.x

et_raw$visualWM_achteruit_corr.x <- as.numeric(et_raw$achteruit_corr.x)
et_raw$visualWM_achteruit_span.x <- as.numeric(et_raw$achteruit_span.x)

vis_wm_bw <- et_raw$visualWM_achteruit_corr.x * et_raw$visualWM_achteruit_span.x

vis_wm_ce <- (vis_wm_bw - vis_wm_enc)/vis_wm_enc

et_raw$verbalWM_vooruit_corr.y <- as.numeric(et_raw$vooruit_corr.y)
et_raw$verbalWM_vooruit_span.y <- as.numeric(et_raw$vooruit_span.y)
ver_wm_enc <- et_raw$verbalWM_vooruit_corr.y * et_raw$verbalWM_vooruit_span.y

et_raw$verbalWM_achteruit_corr.y <- as.numeric(et_raw$achteruit_corr.y)
et_raw$verbalWM_achteruit_span.y <- as.numeric(et_raw$achteruit_span.y)
ver_wm_bw <- et_raw$verbalWM_achteruit_corr.y * et_raw$verbalWM_achteruit_span.y

ver_wm_ce <- (ver_wm_bw - ver_wm_enc)/ver_wm_enc

exec_mrt <- et_raw$executive_mrt
exec_acc <- et_raw$executive_acc

```

```{r select }

# select the relevant variables from database
et_select_att <- et_raw[c("subj", "test", "mrt_neutral", "sd_neutral", "alerting_mrt", "orienting_mrt", "sustained_mrt", "tau")]

et_select_mem <- data.frame(vis_mem_cap, vis_mem_rate, vis_mem_enc, vis_mem_ret, vis_mem_cons, ver_mem_cap, ver_mem_rate, ver_mem_enc, ver_mem_ret, ver_mem_cons)

et_select_visuom <- data.frame(visuom_fixed_m, visuom_fixed_sd, visuom_random_d, visuom_speed_d)

et_select_wm <- data.frame(vis_wm_enc, vis_wm_ce, ver_wm_enc, ver_wm_ce, exec_mrt, exec_acc)

et_select_ef <- et_raw[c("motor_response")]

et_select <- data.frame(et_select_att, et_select_mem, et_select_visuom, et_select_wm, et_select_ef)
et_select_comp <- data.frame(et_select_att, et_select_mem, et_select_visuom, et_select_wm, et_select_ef)

#transform variables to the same direction: higer score = better performance
et_select_comp$mrt_neutral <- -1 * et_select_comp$mrt_neutral
et_select_comp$sd_neutral <- -1 * et_select_comp$sd_neutral

et_select_comp$alerting_mrt <- -1 * et_select_comp$alerting_mrt
et_select_comp$orienting_mrt <- -1 * et_select_comp$orienting_mrt
et_select_comp$sustained_mrt <- -1 * et_select_comp$sustained_mrt
et_select_comp$tau <- -1 * et_select_comp$tau

et_select_comp$vis_mem_cap <- -1 * et_select_comp$vis_mem_cap
et_select_comp$vis_mem_enc <- -1 * et_select_comp$vis_mem_enc


et_select_comp$visuom_fixed_m <- -1 * et_select_comp$visuom_fixed_m
et_select_comp$visuom_fixed_sd <- -1 * et_select_comp$visuom_fixed_sd
et_select_comp$visuom_random_d <- -1 * et_select_comp$visuom_random_d
et_select_comp$visuom_speed_d <- -1 * et_select_comp$visuom_speed_d

et_select_comp$exec_mrt <- -1 * et_select_comp$exec_mrt
et_select_comp$motor_response <- -1 * et_select_comp$motor_response

subj_t <- (et_select_comp$subj * 10) + 1

```

